pomdp
observables
started, r1taken, r2taken, r3taken, r4taken, done
endobservables
const int N;
const int xMAX = N-1;
const int yMAX = N-1;
const int xMIN = 0;
const int yMIN = 0;
const double slippery = 0.1;
// How likely is a rock a good rock
const double goodrock = 0.5;
const int primaryMinX = 0;
const int primaryMinY = 0;
const int primaryMaxX = 7;
const int primaryMaxY = 7;
const int pad = 2;
const int areaMinX = max(primaryMinX - pad, xMIN);
const int areaMinY = max(primaryMinY - pad, yMIN);
const int areaMaxX = min(primaryMaxX + pad, xMAX);
const int areaMaxY = min(primaryMaxY + pad, yMAX);
const r1x = 1;
const r1y = 2;
const r2x = 3;
const r2y = 0;
const r3x = 3;
const r3y = 5;
const r4x = 6;
const r4y = 2;
// We are done when we reach max x location
formula finish = started & x = xMAX;
observable "seefinish" = finish;
formula maxdist = xMAX-xMIN+yMAX-yMIN;
formula good = finish & done & ((!r1qual & !r2qual & !r3qual & !r4qual) | (r1taken | r2taken | r3taken | r4taken));
formula r1dist = max(r1x-x,x-r1x) + max(r1y-y,y-r1y);
formula r2dist = max(r2x-x,x-r2x) + max(r2y-y,y-r2y);
formula r3dist = max(r3x-x,x-r3x) + max(r3y-y,y-r3y);
formula r4dist = max(r4x-x,x-r4x) + max(r4y-y,y-r4y);
formula bad = (r1dist=0 & !r1qual) | (r2dist=0 & !r2qual) | (r3dist=0 & !r3qual) | (r4dist=0 & !r4qual);
formula normdistr1 = (r1dist <= 1) ? 1 : 2; // min(1+((r1dist-1)/maxdist), 1.0)
formula normdistr2 = (r2dist <= 1) ? 1 : 2; // min(1+((r2dist-1)/maxdist), 1.0)
formula normdistr3 = (r3dist <= 1) ? 1 : 2; // min(1+((r3dist-1)/maxdist), 1.0)
formula normdistr4 = (r4dist <= 1) ? 1 : 2; // min(1+((r4dist-1)/maxdist), 1.0)
observable "atr1" = r1dist <= 0;
observable "atr2" = r2dist <= 0;
observable "atr3" = r3dist <= 0;
observable "atr4" = r4dist <= 0;
observable "nearr1" = r1dist <= 1;
observable "nearr2" = r2dist <= 1;
observable "nearr3" = r3dist <= 1;
observable "nearr4" = r4dist <= 1;
observable "seebad" = bad;
observable "seegood" = good;
module master
started : bool init false;
done : bool init false;

[placement] !started -> (started'=true);
[north] started & !done -> true;
[south] started  & !done -> true;
[east] started  & !done-> true;
[west] started & !done -> true;
[finish] finish | done -> (done'=true);
endmodule
module robot
x : [areaMinX..areaMaxX] init 3;
y : [areaMinY..areaMaxX] init 4;

[west] true -> (1-slippery): (x'=max(x-1,areaMinX)) + slippery: (x'=max(x-2,areaMinX));
[east] true -> (1-slippery): (x'=min(x+1,areaMaxX)) + slippery: (x'=min(x+2,areaMaxX));
[south]  true -> (1-slippery): (y'=min(y+1,areaMaxY)) + slippery: (y'=min(y+2,areaMaxY));
[north]  true -> (1-slippery): (y'=max(y-1,areaMinY)) + slippery: (y'=max(y-2,areaMinY));
endmodule
module rock1
r1qual : bool init false;
r1taken : bool init false;
r1lastobs : bool init false;
[placement] true -> goodrock : (r1qual'=true) + (1-goodrock) : (r1qual'=false);

[r1sample] r1dist = 0 & started & !done & !bad & !finish & !r1taken-> 1:(r1taken'=(x = r1x & y = r1y & !r1taken));
[r1sample] r1dist = 0 & started & !done & !bad & !finish & r1taken -> true;

[r1sense] started & !r1taken & !done & !bad & !finish -> (1/normdistr1): (r1lastobs'=r1qual) +  (1-(1/normdistr1)): (r1lastobs'=!r1qual);
[north] true -> (r1lastobs'=false);
[south] true -> (r1lastobs'=false);
[east] true -> (r1lastobs'=false);
[west] true -> (r1lastobs'=false);
endmodule
module rock2
r2qual : bool init false;
r2taken : bool init false;
r2lastobs : bool init false;
[placement] true -> goodrock : (r2qual'=true) + (1-goodrock) : (r2qual'=false);

[r2sample] r2dist = 0 & started & !done & !bad & !finish & !r2taken-> 1:(r2taken'=(x = r2x & y = r2y & !r2taken));
[r2sample] r2dist = 0 & started & !done & !bad & !finish & r2taken -> true;

[r2sense] started & !r2taken & !done & !bad & !finish -> (1/normdistr2): (r2lastobs'=r2qual) +  (1-(1/normdistr2)): (r2lastobs'=!r2qual);
[north] true -> (r2lastobs'=false);
[south] true -> (r2lastobs'=false);
[east] true -> (r2lastobs'=false);
[west] true -> (r2lastobs'=false);
endmodule
module rock3
r3qual : bool init false;
r3taken : bool init false;
r3lastobs : bool init false;
[placement] true -> goodrock : (r3qual'=true) + (1-goodrock) : (r3qual'=false);

[r3sample] r3dist = 0 & started & !done & !bad & !finish & !r3taken-> 1:(r3taken'=(x = r3x & y = r3y & !r3taken));
[r3sample] r3dist = 0 & started & !done & !bad & !finish & r3taken -> true;

[r3sense] started & !r3taken & !done & !bad & !finish -> (1/normdistr3): (r3lastobs'=r3qual) +  (1-(1/normdistr3)): (r3lastobs'=!r3qual);
[north] true -> (r3lastobs'=false);
[south] true -> (r3lastobs'=false);
[east] true -> (r3lastobs'=false);
[west] true -> (r3lastobs'=false);
endmodule
module rock4
r4qual : bool init false;
r4taken : bool init false;
r4lastobs : bool init false;
[placement] true -> goodrock : (r4qual'=true) + (1-goodrock) : (r4qual'=false);

[r4sample] r4dist = 0 & started & !done & !bad & !finish & !r4taken-> 1:(r4taken'=(x = r4x & y = r4y & !r4taken));
[r4sample] r4dist = 0 & started & !done & !bad & !finish & r4taken -> true;

[r4sense] started & !r4taken & !done & !bad & !finish -> (1/normdistr4): (r4lastobs'=r4qual) +  (1-(1/normdistr4)): (r4lastobs'=!r4qual);
[north] true -> (r4lastobs'=false);
[south] true -> (r4lastobs'=false);
[east] true -> (r4lastobs'=false);
[west] true -> (r4lastobs'=false);
endmodule
label "notbad" = !bad;
label "goal" = good;
label "rockposition" = (!r1taken & r1x = x & r1y = y) | (!r2taken & r2x = x & r2y = y) | (!r3taken & r3x = x & r3y = y) | (!r4taken & r4x = x & r4y = y);
rewards "rew"
[r1sample] r1qual & !r1taken : 100;
[r2sample] r2qual & !r2taken : 100;
[r3sample] r3qual & !r3taken : 100;
[r4sample] r4qual & !r4taken : 100;
[finish] ((!r1qual & !r2qual & !r3qual & !r4qual) | (r1taken | r2taken | r3taken | r4taken)): 100;
[finish] true: 20;
endrewards
rewards "cos"
//[r1sample] !r1qual & !r1taken : 10; // no need; cause it won't r1sample is not enabled if !r1qual
//[r2sample] !r2qual & !r1taken: 10; // no need; cause it won't r1sample is not enabled if !r1qual
//[r1sample] r1taken : 20;
//[r2sample] r2taken : 20;
[finish] !((!r1qual & !r2qual & !r3qual & !r4qual) | (r1taken | r2taken | r3taken | r4taken)): 100;
bad:20;
[east] true: 1;
[west] true: 1;
[north] true: 1;
[south] true: 1;
[r1sense] true: 1;
[r2sense] true: 1;
[r3sense] true: 1;
[r4sense] true: 1;
[r1sample] true: 1;
[r2sample] true: 1;
[r3sample] true: 1;
[r4sample] true: 1;
endrewards
rewards "cost"
[r1sense] true : 1;
[r1sample] !r1qual : 20;
[r2sense] true : 1;
[r2sample] !r2qual : 20;
//[r3sense] true : 1;
//[r3sample] !r3qual : 20;
[north] true : 1;
[south] true : 1;
[west] true : 1;
[east] true : 1;
[finish] true : (!r1taken & r1qual ? 30 : 0) + (!r2taken & r2qual ? 30 : 0) ;//+ (!r3taken & r3qual ? 30 : 0) ;
endrewards