mdp

const int M = 15;
const int N = 15;
const double p=0.4; // with probability p robot moves to an adjacent location instead of desired
const int MAX_STEPS=15; // time cut off
const int TERM_COST = 500;

formula treasure = (c=1 & r=4)|(c=2 & r=6)|(c=3 & r=6)| (c=4 & r=7)|(c=5 & r=8)|(c=6 & r=8)|(c=7 & r=9)|(c=8 & r=10)|(c=9 & r=10)|(c=10 & r=11)|(c=11 & r=12)|(c=12 & r=12)|(c=13 & r=13)|(c=14 & r=14)|(c=15 & r=14);
formula wall = (c=1 & r>4) | ((c=2 | c=3) & r>6) | (c=4 & r>7) | ((c=5 | c=6) & r>8) | (c=7 & r>9) | ((c=8 | c=9) & r>10)| (c=10 & r>11) | ((c=11 | c=12) & r>12)| (c=13 & r>13) | ((c=14 | c=15) & r>14);

// action guards i.e. if south wall is true -> south action should not be allowed
formula west_wall = (c=2 & r=5);
formula south_west_wall = (c=2 & (r=4 | r=5)) | (c=4 & r=6) | (c=5 & r=7) | (c=7 & r=8) | (c=8 & r=9)| (c=10 & r=10) | (c=11 & r=11)| (c=13 & r=12) | (c=14 & r=13);

module robot
	//define robot position
	r:[1..N] init 2; //grid row
	c:[1..M] init 1; //grid column
    t:[1..MAX_STEPS+1] init 1; // time step

	// transitions
	[end] treasure -> (t'=MAX_STEPS+1);
	[end] (t=MAX_STEPS) -> (t'=t+1);
	[east]  (c<M | c=M) & (t<MAX_STEPS)-> p/2:(r'=min(r+1, N))&(c'=min(c+1, M))&(t'=min(t+1, MAX_STEPS))+ p/2: (r'=max(r-1, 1))&(c'=min(c+1, M))&(t'=min(t+1, MAX_STEPS)) + (1-p): (c'=min(c+1, M))&(t'=min(t+1, MAX_STEPS));
	[south] (r<N | r=N) & !south_west_wall & (t<MAX_STEPS) -> (1-p):(r'=min(r+1, N))&(t'=min(t+1, MAX_STEPS)) + p/2: (c'=min(c+1, M))&(r'=min(r+1, N))&(t'=min(t+1, MAX_STEPS))+ p/2: (c'=max(c-1, 1))&(r'=min(r+1, N))&(t'=min(t+1, MAX_STEPS));
	[west]  (c>1 | c=1) & !west_wall & !south_west_wall & (t<MAX_STEPS)-> p/2:(r'=max(r-1, 1))&(c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS))+ p/2:(r'=min(r+1, N))&(c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS)) + (1-p): (c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS));
	[north] (r=1 | r>1) & (t<MAX_STEPS)-> (1-p):(r'=max(r-1, 1))&(t'=min(t+1, MAX_STEPS)) + p/2: (c'=max(c-1, 1))&(r'=max(r-1, 1))&(t'=min(t+1, MAX_STEPS)) + p/2: (c'=min(c+1, M))&(r'=max(r-1, 1))&(t'=min(t+1, MAX_STEPS)) ;

	[south] (r<N | r=N) &  south_west_wall & (t<MAX_STEPS)-> (1-p):(r'=min(r+1, N))&(t'=min(t+1, MAX_STEPS)) + p: (c'=max(c-1, 1))&(r'=min(r+1, N))&(t'=min(t+1, MAX_STEPS));
    [west]  (c>1 | c=1) & !west_wall & south_west_wall & (t<MAX_STEPS)-> p:(r'=max(r-1, 1))&(c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS)) + (1-p): (c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS));

    // diagonal transitions
    [north_east] (c<M | c=M) & (r=1 | r>1)  & (t<MAX_STEPS) -> p/2:(c'=min(c+1, M))&(t'=min(t+1, MAX_STEPS))+ p/2: (r'=max(r-1, 1))&(t'=min(t+1, MAX_STEPS)) + (1-p): (c'=min(c+1, M))&(r'=max(r-1, 1))&(t'=min(t+1, MAX_STEPS));
    [north_west] (c>1 | c=1) & (r=1 | r>1) & !west_wall & (t<MAX_STEPS) -> (1-p):(r'=max(r-1, 1))&(c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS)) + p/2: (r'=max(r-1, 1))&(t'=min(t+1, MAX_STEPS))+ p/2: (c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS));
    [south_east] (c<M | c=M) & (r<N | r=N) & (t<MAX_STEPS) -> p/2:(c'=min(c+1, M))&(t'=min(t+1, MAX_STEPS))+ p/2:(r'=min(r+1, N))&(t'=min(t+1, MAX_STEPS)) + (1-p): (r'=min(r+1, N))&(c'=min(c+1, M))&(t'=min(t+1, MAX_STEPS));
    [south_west] (c>1 | c=1) & (r<N | r=N) & !south_west_wall & !west_wall & (t<MAX_STEPS) -> (1-p):(r'=min(r+1, N))&(c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS)) + p/2: (c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS)) + p/2: (r'=min(r+1, N))&(t'=min(t+1, MAX_STEPS)) ;

    [north_west] (c>1 | c=1) & (r=1 | r>1) & west_wall & (t<MAX_STEPS) -> (1-p):(r'=max(r-1, 1))&(c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS)) + p: (r'=max(r-1, 1))&(t'=min(t+1, MAX_STEPS));
    [south_west] (c>1 | c=1) & (r<N | r=N) & !south_west_wall & west_wall & (t<MAX_STEPS) -> (1-p):(r'=min(r+1, N))&(c'=max(c-1, 1))&(t'=min(t+1, MAX_STEPS)) + p: (r'=min(r+1, N))&(t'=min(t+1, MAX_STEPS)) ;

endmodule

label "goal" = (t=MAX_STEPS+1);
label "obs" = wall;

rewards
    [] true: 5;
    [end] (t=MAX_STEPS) : 500;
    [end] (c=1 & r=4): 490;
    [end] (c=2 & r=6): 485;
    [end] (c=3 & r=6): 475;
    [end] (c=4 & r=7): 470;
    [end] (c=5 & r=8): 460;
    [end] (c=6 & r=8): 445;
    [end] (c=7 & r=9): 425;
    [end] (c=8 & r=10): 400;
    [end] (c=9 & r=10): 360;
    [end] (c=10 & r=11): 310;
    [end] (c=11 & r=12): 260;
    [end] (c=12 & r=12): 200;
    [end] (c=13 & r=13): 140;
    [end] (c=14 & r=14): 70;
    [end] (c=15 & r=14): 0;
endrewards